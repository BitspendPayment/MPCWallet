syntax = "proto3";

package mpc_wallet;

service MPCWallet {
  // DKG
  rpc DKGStep1 (DKGStep1Request) returns (DKGStep1Response);
  rpc DKGStep2 (DKGStep2Request) returns (DKGStep2Response);
  rpc DKGStep3 (DKGStep3Request) returns (DKGStep3Response);

  // Signing
  rpc SignStep1 (SignStep1Request) returns (SignStep1Response);
  rpc SignStep2 (SignStep2Request) returns (SignStep2Response);
}

// DKG Messages

message DKGStep1Request {
  string device_id = 1;
  bytes identifier = 2;
  string round1_package = 3; // JSON
}

message DKGStep1Response {
  map<string, string> round1_packages = 1; 
}

message DKGStep2Request {
  string device_id = 1;
  bytes identifier = 2;
  string round1_package = 3; // JSON
}

message DKGStep2Response {
   map<string, string> all_round1_packages = 1;
}

message DKGStep3Request {
   string device_id = 1;
   bytes identifier = 2;
   map<string, string> round2_packages_for_others = 3;
}

message DKGStep3Response {
    map<string, string> round2_packages_for_me = 1;
}

// Signing Messages

message SignStep1Request {
  string device_id = 1;
  bytes identifier = 2;
  bytes hiding_commitment = 3;
  bytes binding_commitment = 4;
  bytes message_to_sign = 5; 
}

message SignStep1Response {
   message Commitment {
       bytes hiding = 1;
       bytes binding = 2;
   }
   map<string, Commitment> commitments = 1;
   bytes message_to_sign = 2; 
}

message SignStep2Request {
   string device_id = 1;
   bytes identifier = 2;
   bytes signature_share = 3;
}

message SignStep2Response {
   // Final aggregated signature
   // (R, z)
   bytes r_point = 1;
   bytes z_scalar = 2;
}
